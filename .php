explain analyze WITH option_values AS (
SELECT
    a.code AS attribute_code,
    ao.code AS option_code,
    JSON_OBJECTAGG(aov.locale_code, aov.value) AS option_values
FROM pim_catalog_attribute AS a
JOIN pim_catalog_attribute_option AS ao ON ao.attribute_id = a.id
JOIN pim_catalog_attribute_option_value AS aov ON aov.option_id = ao.id
WHERE (ao.code, ao.attribute_id) IN (('attopt_color_code_mf_simpleselect_1732', 1780), ('attopt_fedas_product_type_217377', 1767), ('attopt_color_code_mf_simpleselect_9060', 1780), ('attopt_color_code_mf_simpleselect_4232', 1780), ('attopt_fedas_product_type_169965', 1767), ('attopt_fedas_gender_code_gog_171189', 1771), ('attopt_fedas_gender_code_gog_899141', 1771), ('attopt_size_gloves_90', 1775), ('attopt_fedas_product_type_240702', 1767), ('attopt_color_code_mf_simpleselect_2823', 1780), ('attopt_fedas_gender_code_gog_232151', 1771),('attopt_brand_pakros', 884), ('attopt_fedas_product_type_200064', 1767), ('attopt_fedas_product_type_275133', 1767), ('attopt_fedas_gender_code_gog_135935', 1771),('attopt_brand_haferl', 884),('attopt_brand_gregory', 884), ('attopt_color_code_mf_simpleselect_9302', 1780),('attopt_size_international_5xl_tall', 928), ('attopt_fedas_field_269817', 1768), ('attopt_size_gloves_10', 1775), ('attopt_fedas_product_type_210318', 1767), ('attopt_color_code_mf_simpleselect_5662', 1780), ('attopt_fedas_product_type_238433', 1767), ('attopt_color_code_mf_simpleselect_8548', 1780),('attopt_brand_stallion', 884), ('attopt_size_cm_range_50_to_52', 1805), ('attopt_fedas_field_246532', 1768), ('attopt_size_bra_70c_to_d', 1748), ('attopt_color_code_mf_simpleselect_3461', 1780), ('attopt_color_code_mf_simpleselect_9086', 1780),('attopt_brand_invu', 884),('attopt_brand_tecnica', 884), ('attopt_color_code_mf_simpleselect_8752', 1780), ('attopt_fedas_product_type_167863', 1767), ('attopt_fedas_field_138739', 1768), ('attopt_fedas_gender_code_gog_235728', 1771), ('attopt_fedas_field_732200', 1768), ('attopt_fedas_field_224158', 1768), ('attopt_fedas_field_219011', 1768), ('attopt_fedas_field_278434', 1768), ('attopt_fedas_field_167305', 1768), ('attopt_size_trousers_inch_3226', 1779), ('attopt_size_ltr_145', 1799), ('attopt_color_code_mf_simpleselect_8966', 1780), ('attopt_color_code_mf_simpleselect_2295', 1780), ('attopt_fedas_product_type_275213', 1767), ('attopt_fedas_gender_code_gog_235378', 1771), ('attopt_fedas_product_type_109988', 1767),('attopt_brand_stefanotema', 884), ('attopt_fedas_field_167400', 1768), ('attopt_fedas_gender_code_gog_209314', 1771), ('attopt_fedas_field_278286', 1768), ('attopt_color_code_mf_simpleselect_0288', 1780), ('attopt_fedas_gender_code_gog_215616', 1771), ('attopt_fedas_product_type_234274', 1767), ('attopt_color_code_mf_simpleselect_7412', 1780), ('attopt_fedas_gender_code_gog_216615', 1771), ('attopt_fedas_field_101728', 1768), ('attopt_fedas_product_type_204124', 1767), ('attopt_fedas_product_type_178126', 1767), ('attopt_fedas_product_type_371015', 1767), ('attopt_fedas_field_121105', 1768), ('attopt_fedas_field_899161', 1768), ('attopt_color_code_mf_simpleselect_1894', 1780), ('attopt_fedas_product_type_704950', 1767), ('attopt_fedas_field_654040', 1768), ('attopt_fedas_field_658012', 1768), ('attopt_fedas_product_type_135794', 1767), ('attopt_color_code_mf_simpleselect_1974', 1780), ('attopt_fedas_product_type_198601', 1767), ('attopt_color_code_mf_simpleselect_2604', 1780), ('attopt_fedas_field_270078', 1768), ('attopt_fedas_product_type_218122', 1767), ('attopt_fedas_product_type_260332', 1767), ('attopt_fedas_gender_code_gog_209552', 1771), ('attopt_fedas_product_type_235928', 1767), ('attopt_fedas_field_215312', 1768), ('attopt_fedas_field_234434', 1768), ('attopt_color_code_mf_simpleselect_0173', 1780), ('attopt_color_code_mf_simpleselect_5208', 1780), ('attopt_fedas_product_type_164769', 1767), ('attopt_size_m_56', 1013), ('attopt_fedas_gender_code_gog_332106', 1771), ('attopt_fedas_field_224298', 1768), ('attopt_fedas_field_218314', 1768), ('attopt_color_code_mf_simpleselect_9803', 1780), ('attopt_fedas_product_type_662032', 1767), ('attopt_color_code_mf_simpleselect_3027', 1780), ('attopt_color_code_mf_simpleselect_7883', 1780), ('attopt_color_code_mf_simpleselect_2057', 1780),('attopt_brand_pieceofmind', 884),('attopt_brand_paulog', 884), ('attopt_fedas_gender_code_gog_260432', 1771), ('attopt_color_code_mf_simpleselect_7189', 1780), ('attopt_fedas_field_121942', 1768), ('attopt_fedas_product_type_262288', 1767), ('attopt_fedas_product_type_260592', 1767), ('attopt_fedas_gender_code_gog_298275', 1771), ('attopt_fedas_gender_code_gog_101623', 1771))
AND aov.value IS NOT NULL
GROUP BY attribute_code, ao.code
),
aggregated_option_per_attribute AS (
SELECT
    attribute_code,
    JSON_OBJECTAGG(option_code, option_values) as option_values
FROM option_values
GROUP BY attribute_code
)
SELECT JSON_OBJECTAGG(attribute_code, option_values) as result
FROM aggregated_option_per_attribute;
